const CACHE_NAME = 'ChatOne'; const urlsToCache = [ '/', ]; self.addEventListener('install', function(event) { event.waitUntil( caches.open(CACHE_NAME) .then(function(cache) { console.log('Cache opened'); return cache.addAll(urlsToCache); }) ); }); self.addEventListener('activate', function(event) { event.waitUntil( caches.keys().then(function(cacheNames) { return Promise.all( cacheNames.map(function(cacheName) { if (cacheName !== CACHE_NAME) { return caches.delete(cacheName); } }) ); }) ); }); self.addEventListener('fetch', function(event) { event.respondWith( caches.match(event.request) .then(function(response) { if (response) { return response; } return fetch(event.request) .then(function(networkResponse) { if (!networkResponse || networkResponse.status !== 200 || networkResponse.type !== 'basic') { return networkResponse; } let responseToCache = networkResponse.clone(); caches.open(CACHE_NAME) .then(function(cache) { cache.put(event.request, responseToCache); }); return networkResponse; }) .catch(function() { return caches.match(event.request); }); }) ); }); self.addEventListener('beforeinstallprompt', function(event) { event.preventDefault(); deferredPrompt = event; if (!window.matchMedia('(display-mode: standalone)').matches) { showInstallPromotion(); } }); function showInstallPromotion() { const installButton = document.createElement('button'); installButton.textContent = 'Install App'; installButton.addEventListener('click', function() { deferredPrompt.prompt(); deferredPrompt.userChoice.then((choiceResult) => { if (choiceResult.outcome === 'accepted') { console.log('User accepted the A2HS prompt'); } else { console.log('User dismissed the A2HS prompt'); } deferredPrompt = null; }); }); document.body.appendChild(installButton);}